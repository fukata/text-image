<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Text Image</title>

  <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css" integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w" crossorigin="anonymous">
  <!--[if lte IE 8]>
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
      <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/grids-responsive-min.css">
  <!--<![endif]-->
</head>
<body style="background-color: #ccc;">
  <form class="pure-form" onsubmit="createImage(); return false">
    <div>
      <p>テキスト(目安: 10文字程度)</p>
      <input type="text" id="image_text" value="Hello World">
    </div>
    <div class="pure-g">
      <div class="pure-u-1 pure-u-md-1-5">
        <p>背景色</p>
        <input type="text" id="image_bgcolor" value="#ffffff">
      </div>
      <div class="pure-u-1 pure-u-md-1-5">
        <p>文字色</p>
        <input type="text" id="image_text_color" value="#333333">
      </div>
      <div class="pure-u-1 pure-u-md-1-5">
        <p>文字サイズ</p>
        <input type="number" id="image_text_size" value="128"> px
      </div>
      <div class="pure-u-1 pure-u-md-1-5">
        <p>画像サイズ(width)</p>
        <input type="number" id="image_width" value="1280"> px
      </div>
      <div class="pure-u-1 pure-u-md-1-5">
        <p>画像サイズ(height)</p>
        <input type="number" id="image_height" value="720"> px
      </div>
    </div>

    <hr>

    <div>
      <button type="submit" id="submit_button" class="pure-button pure-button-primary" onclick="createImage()">画像を作成</button>
      <a href="#" download="" id="download_link" class="pure-button pure-button-primary">ダウンロード</a>
    </div>
  </form>

  <div>
    <p>結果</p>
    <img src="" id="result_image">
  </div>

  <div style="display:none;">
    <p>ダミー</p>
    <canvas id="dummy_canvas" width="1280" height="720"></canvas>
  </div>

  <script>
    function createImage() {
      var text = document.getElementById('image_text').value;

      // 適切な文字サイズを計算
      var fontSize = document.getElementById('image_text_size').value; // 最大
      var fontFamily = 'Verdana';

      // フォントを中心に配置する座標
      var imageWidth = document.getElementById('image_width').value;
      var imageHeight = document.getElementById('image_height').value;

      // canvasを白色で初期化
      var canvas = document.getElementById('dummy_canvas');
      canvas.width = imageWidth;
      canvas.height = imageHeight;
      var ctx = canvas.getContext('2d');
      ctx.fillStyle = document.getElementById('image_bgcolor').value;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // canvasにテキストを書き込み
      ctx.fillStyle = document.getElementById('image_text_color').value;
      ctx.font = fontSize + 'px ' + fontFamily;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(text, imageWidth / 2, imageHeight / 2);

      // canvasからdataURLをimgにコピー
      var dataURL = canvas.toDataURL();
      document.getElementById('result_image').src = dataURL;

      var downloadLink = document.getElementById('download_link');
      download_link.href = dataURL;
      download_link.download = text + ".png";
    }

    createImage();
  </script>
</body>
</html>
